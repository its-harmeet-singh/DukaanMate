# DukaanMate
## Final-Project-CS50x23
By: Vaishali Tyagi and Harmeet Singh

#### Video Demo: https://youtu.be/1fTHw286wqU

#### DESCRIPTION:
DukaanMate is a web application designed for small businesses to manage their inventory, generate invoices and track daily sales. It has a user-friendly interface with a variety of features that cater to both admin and general users.

The application has an Index Desktop that serves as a dashboard and provides easy access to all other functionalities. Users can navigate to different features by clicking on the buttons. One of the primary functionalities of DukaanMate is creating invoices. Users can generate PDF bills for their customers, which they can print. This feature saves time and reduces errors associated with manual billing. The application has a login page for both admin and general users. Admins can register new users and manage the inventory. They can add items, update their details, and manage money withdrawal. General users can access features such as adding items and weights to the inventory. Admins can also register new users, and this feature is accessible only to them. Additionally, they can update item details and add weight for raw and processed products. General users can also add weight details to the inventory. DukaanMate offers a total purchase desktop feature that shows the total daily purchase. Users can generate PDFs with daily purchase data, view daily total purchase, and track past seven days' data with graphs.

Finally, the application has a worker's feature that allows admins to add people and manage their details. With DukaanMate, small businesses can streamline their inventory management, billing, and sales tracking, leading to increased efficiency and profitability.


##### INDEX Function

The function queries a database (which is likely connected to the web app), specifically a table called "transactions", to obtain the total amount of deposits made in the current day, as well as the 5 most recent withdrawals made on the current day. The total amount of deposits is obtained by using the SQL aggregate function SUM(), which sums up the values of the "amount" column for all rows where the "transaction_time" column is greater than or equal to the current date and the "withdrawal_or_deposit" column has the value 'deposit'. The result is stored in a variable named total_sale. Next, the function queries the same table for the 5 most recent withdrawals made on the current day, sorted by amount in ascending order. The result is stored in a variable named updates. The function then creates a list of strings containing details of each withdrawal, such as the amount, the recipient, and the reason. Each string is constructed by concatenating the relevant values from a row of the updates variable. Finally, the function returns the rendered HTML template "index.html", which contains placeholders for the total_sale and list_updates variables. The values of these variables are passed to the template as arguments


##### Bill Generation

The function begins with a conditional statement that checks if the "printed" key exists in the "cart" dictionary stored in the "session" object. If the key exists and its value is "printed", then the "cart" dictionary is reset to an empty dictionary with default values. This is likely done to clear the session data after the user has generated and printed a bill. Next, the function checks if the HTTP request method is "POST". If it is, the function processes the form data submitted by the user. The function checks if the "billGen-button" key in the form data has a value of "Add Item", which indicates that the user wants to add an item to the cart. If this is the case, the function retrieves the necessary data from the form, including the customer name, phone number, item ID, discount, and quantity. It then uses the item ID to query the database for details about the item, including its name and price. The function then calculates the total price of the item by multiplying the price per kilogram by the quantity and subtracting the discount. The function then updates the "cart_item" dictionary stored in the "cart" dictionary in the session object. If the item is already in the cart, the function updates the quantity, total price, and discount of the existing item instead of creating a new item. If the item is not in the cart, the function adds the item to the list of cart items. Finally, the function queries the database for a list of items and renders the "billGen.html" template with the items list as a parameter. If the HTTP request method is not "POST", the function simply queries the database for a list of items and renders the template with the items list as a parameter. Overall, it appears that this function is responsible for generating a bill for a customer, including adding items to the cart, calculating prices and discounts, and displaying the bill on a web page.


##### Login

This function is responsible for logging in a user. It clears any previous user session and checks if the user has submitted the login form via POST. If so, it checks if a username and password have been provided. If not, it renders an error page with an appropriate message and code. If the username and password are provided, the function queries the database to check if the user exists and if the password is correct. If not, it renders an error page with an appropriate message and code. If the user is authenticated, the function saves the user's ID, username, and today's date in the session. It also checks if the user is an admin and saves this information in the session if so. Finally, it initializes a shopping cart in the session and redirects the user to the home page. If the user did not reach the route via POST, the function renders the login page.


##### Register

If the request method is "POST", the function gets the user's first name, last name, email, phone number, and whether or not they are an admin from the submitted form. It then inserts this information into the "Person" table of the database using the "db.execute()" function. If the user is an admin, the function inserts the isadmin field into the "Person" table as well. The function then queries the "Person" table to retrieve the user's unique ID, which is stored in the variable "person_id". This variable is passed to the "Credentials.html" template using "render_template()", so that the user can create login credentials associated with their newly registered account. If the request method is not "POST", the function renders the "register.html" template, which contains a form for the user to submit their personal information.

##### Add Item

This function is a route that allows an administrator to add a new item to the online store's inventory. The route can be accessed via a GET or POST request. The function first checks if the request method is POST. If so, it retrieves the relevant form data (item name, price, quantity, category ID, retail discount, and wholesale discount) using the request.form.get() method. The function then queries the database to get all items and compares the item name of the new item with the existing items in the inventory. If an item with the same name already exists, the function updates its details instead of creating a new item. If not, it inserts the new item's details into the Item table in the database. If the category ID provided in the form is 0, it means that the user has selected the "New Category" option. In this case, the function retrieves the name of the new category from the form data and inserts it into the Category table in the database. It then retrieves the ID of the new category and uses it to insert the new item into the Item table. If the request method is GET, the function retrieves all categories from the Category table and renders the "additem.html" template with the category data passed to the template.


##### Purchase Desktop

It starts by querying the database for the total quantity of each item sold today and calculates the percentage of sales for each item. It also queries the database for the dates of the past 7 days and the top 5 items sold in that period. Next, it creates a list of dates and data for each top item sold in the past 7 days. The data includes the total quantity sold for each item on each day. Then, it queries the database for all transactions made today and calculates the total amount spent. Finally, it renders the "purchaseDesktop.html" template with the generated data, which includes the product-wise sales percentage, past seven days sales for top items, transactions made today, and the total amount spent.


##### Sale

When a GET request is made to this route, the function renders the "sale.html" template with an empty list of transactions and a total_amount of 0. When a POST request is made to this route, the function retrieves the selected_date value from the form, queries the database for transactions that match the selected date using a LIKE operator, and retrieves the sold items for each transaction using another database query. The function then calculates the total amount for all transactions and passes the transactions and the total_amount to the "sale.html" template, which displays them in a table.


##### History

The function retrieves data by executing a SQL query on a database, which includes selecting the full name, transaction ID, transaction time, transaction recipient, person phone number, and amount for transactions that occurred on or after the current date and involve the user ID passed as an argument to the function. The function then initializes a variable called "total_amount" to zero and creates a loop that iterates over each transaction returned by the SQL query. Within the loop, the function retrieves a list of items sold in the transaction by executing another SQL query that selects all sold items associated with the current transaction ID. The function then creates a string representation of the sold items by concatenating their names with commas. Next, the function updates the "total_amount" variable by adding the amount associated with the current transaction, and then adds the string representation of the sold items as a new key-value pair to the current transaction dictionary. Finally, the function returns the template "history.html", which expects two arguments, "transactions" and "total_amount". The "transactions" argument is a list of dictionaries, each containing information about a specific transaction, including the associated person's full name, transaction ID, transaction time, transaction recipient, person phone number, amount, and list of sold items. The "total_amount" argument is a float representing the sum of all amounts associated with the retrieved transactions.


##### Change Password

The function begins by checking whether the request method is "POST". If it is, the function retrieves the user's credential ID, the updated password, and the re-entered password from the request form. If the credential ID is null or zero, or if the updated password and re-entered password do not match or are null, the function returns an error message using the render_template() function. If the user input is valid, the function updates the user's password in the "Credentials" table of the database using a SQL query. The SQL query uses the execute() method on the database object "db" to update the password column in the "Credentials" table for the row that matches the provided credential ID. The new password is set to the value of the re-entered password. After updating the database, the function retrieves a list of all users from the "Credentials" and "Person" tables of the database using another SQL query. The function then returns the user to the home page using the redirect() function. If the request method is not "POST", the function simply retrieves the list of all users from the database and renders the "changePassword.html" template with two arguments, "users" and "json_user". The "users" argument is a list of dictionaries, each containing information about a specific user, including the person ID, username, credential ID, and full name. The "json_user" argument is a JSON-encoded version of the "users" list, which can be used for further processing by JavaScript. In summary, this function allows users to change their passwords by updating the "Credentials" table of the database, and also provides a list of all users to be displayed on the "changePassword.html" template.
